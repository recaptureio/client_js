!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.recapture=e():t.recapture=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){var n=r(1),o=new n;if(window.recapture)for(;window.recapture.length>0;){var i=window.recapture.shift(),s=i.shift();o[s]&&o[s].apply(o,i)}t.exports=o},function(t,e,r){"use strict";function n(){}var o=r(2),i=r(3),s=r(8),u=r(9),a={autoDetectEmail:!0};n.prototype.init=function(t,e){return this.key=t,this.debugging=!1,this.options=s({},a,e),this.options.autoDetectEmail&&this.use(r(12)),this},n.prototype.debug=function(){return this.debugging=!0,this},n.prototype.use=function(t){return t(this),this},n.prototype.cart=function(t){if(!i(t))throw new TypeError("First argument passed into .cart() must be an object");if(!t.hasOwnProperty("cart_id"))throw new Error(".cart() method requires a cart_id");return this.track("cart",t),this},n.prototype.conversion=function(t){if(!i(t))throw new TypeError("First argument passed into .conversion() must be an object");if(!t.hasOwnProperty("cart_id"))throw new Error(".conversion() method requires a cart_id");return this.track("conversion",t),this},n.prototype.email=function(t){if(!i(t))throw new TypeError("First argument passed into .conversion() must be an object");if(!t.hasOwnProperty("email"))throw new Error(".email() method requires a email");if(!this.options.autoDetectEmail&&!o(t.email))throw new TypeError("Invalid email passed in the .email() method");return this.track("email",t),this},n.prototype.track=function(t,e){var r="https:"===document.location.protocol?"https://":"http://",n=r+"recapture.io/beacon/"+t;this.debugging?(console.info("Endpoint URL: ",n),console.info("Endpoint payload: ",e)):u.post(n).set("Api-Key",this.key).type("json").send(e).end(function(t){if(t)throw new Error("Error with beacon request: "+t.message)})},t.exports=n},function(t,e){t.exports=function(t){var e,r;return r=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))){2,6}$/i,e=r.test(t)}},function(t,e,r){function n(t){return!!t&&"object"==typeof t}function o(t,e){return s(t,e,a)}function i(t){var e;if(!n(t)||l.call(t)!=c||u(t)||!p.call(t,"constructor")&&(e=t.constructor,"function"==typeof e&&!(e instanceof e)))return!1;var r;return o(t,function(t,e){r=e}),void 0===r||p.call(t,r)}var s=r(4),u=r(5),a=r(6),c="[object Object]",h=Object.prototype,p=h.hasOwnProperty,l=h.toString;t.exports=i},function(t,e){function r(t){return function(e,r,o){for(var i=n(e),s=o(e),u=s.length,a=t?u:-1;t?a--:++a<u;){var c=s[a];if(r(i[c],c,i)===!1)break}return e}}function n(t){return o(t)?t:Object(t)}function o(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}var i=r();t.exports=i},function(t,e){function r(t){return!!t&&"object"==typeof t}function n(t){return function(e){return null==e?void 0:e[t]}}function o(t){return null!=t&&i(p(t))}function i(t){return"number"==typeof t&&t>-1&&t%1==0&&h>=t}function s(t){return r(t)&&o(t)&&a.call(t,"callee")&&!c.call(t,"callee")}var u=Object.prototype,a=u.hasOwnProperty,c=u.propertyIsEnumerable,h=9007199254740991,p=n("length");t.exports=s},function(t,e,r){function n(t,e){return t="number"==typeof t||c.test(t)?+t:-1,e=null==e?l:e,t>-1&&t%1==0&&e>t}function o(t){return"number"==typeof t&&t>-1&&t%1==0&&l>=t}function i(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function s(t){if(null==t)return[];i(t)||(t=Object(t));var e=t.length;e=e&&o(e)&&(a(t)||u(t))&&e||0;for(var r=t.constructor,s=-1,c="function"==typeof r&&r.prototype===t,h=Array(e),l=e>0;++s<e;)h[s]=s+"";for(var f in t)l&&n(f,e)||"constructor"==f&&(c||!p.call(t,f))||h.push(f);return h}var u=r(5),a=r(7),c=/^\d+$/,h=Object.prototype,p=h.hasOwnProperty,l=9007199254740991;t.exports=s},function(t,e){function r(t){return!!t&&"object"==typeof t}function n(t,e){var r=null==t?void 0:t[e];return u(r)?r:void 0}function o(t){return"number"==typeof t&&t>-1&&t%1==0&&m>=t}function i(t){return s(t)&&d.call(t)==c}function s(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function u(t){return null==t?!1:i(t)?y.test(l.call(t)):r(t)&&h.test(t)}var a="[object Array]",c="[object Function]",h=/^\[object .+?Constructor\]$/,p=Object.prototype,l=Function.prototype.toString,f=p.hasOwnProperty,d=p.toString,y=RegExp("^"+l.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),F=n(Array,"isArray"),m=9007199254740991,v=F||function(t){return r(t)&&o(t.length)&&d.call(t)==a};t.exports=v},function(t,e){"use strict";var r=Object.prototype.hasOwnProperty,n=Object.prototype.toString,o=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===n.call(t)},i=function(t){if(!t||"[object Object]"!==n.call(t))return!1;var e=r.call(t,"constructor"),o=t.constructor&&t.constructor.prototype&&r.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!e&&!o)return!1;var i;for(i in t);return"undefined"==typeof i||r.call(t,i)};t.exports=function s(){var t,e,r,n,u,a,c=arguments[0],h=1,p=arguments.length,l=!1;for("boolean"==typeof c?(l=c,c=arguments[1]||{},h=2):("object"!=typeof c&&"function"!=typeof c||null==c)&&(c={});p>h;++h)if(t=arguments[h],null!=t)for(e in t)r=c[e],n=t[e],c!==n&&(l&&n&&(i(n)||(u=o(n)))?(u?(u=!1,a=r&&o(r)?r:[]):a=r&&i(r)?r:{},c[e]=s(l,a,n)):"undefined"!=typeof n&&(c[e]=n));return c}},function(t,e,r){function n(){}function o(t){var e={}.toString.call(t);switch(e){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}}function i(t){return t===Object(t)}function s(t){if(!i(t))return t;var e=[];for(var r in t)null!=t[r]&&e.push(encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return e.join("&")}function u(t){for(var e,r,n={},o=t.split("&"),i=0,s=o.length;s>i;++i)r=o[i],e=r.split("="),n[decodeURIComponent(e[0])]=decodeURIComponent(e[1]);return n}function a(t){var e,r,n,o,i=t.split(/\r?\n/),s={};i.pop();for(var u=0,a=i.length;a>u;++u)r=i[u],e=r.indexOf(":"),n=r.slice(0,e).toLowerCase(),o=m(r.slice(e+1)),s[n]=o;return s}function c(t){return t.split(/ *; */).shift()}function h(t){return y(t.split(/ *; */),function(t,e){var r=e.split(/ *= */),n=r.shift(),o=r.shift();return n&&o&&(t[n]=o),t},{})}function p(t,e){e=e||{},this.req=t,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||"undefined"==typeof this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText,this.setStatusProperties(this.xhr.status),this.header=this.headers=a(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this.setHeaderProperties(this.header),this.body="HEAD"!=this.req.method?this.parseBody(this.text?this.text:this.xhr.response):null}function l(t,e){var r=this;d.call(this),this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",function(){var t=null,e=null;try{e=new p(r)}catch(n){return t=new Error("Parser is unable to parse the response"),t.parse=!0,t.original=n,r.callback(t)}if(r.emit("response",e),t)return r.callback(t,e);if(e.status>=200&&e.status<300)return r.callback(t,e);var o=new Error(e.statusText||"Unsuccessful HTTP response");o.original=t,o.response=e,o.status=e.status,r.callback(t||o,e)})}function f(t,e){return"function"==typeof e?new l("GET",t).end(e):1==arguments.length?new l("GET",t):new l(t,e)}var d=r(10),y=r(11),F="undefined"==typeof window?this||self:window;f.getXHR=function(){if(!(!F.XMLHttpRequest||F.location&&"file:"==F.location.protocol&&F.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}return!1};var m="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};f.serializeObject=s,f.parseString=u,f.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},f.serialize={"application/x-www-form-urlencoded":s,"application/json":JSON.stringify},f.parse={"application/x-www-form-urlencoded":u,"application/json":JSON.parse},p.prototype.get=function(t){return this.header[t.toLowerCase()]},p.prototype.setHeaderProperties=function(t){var e=this.header["content-type"]||"";this.type=c(e);var r=h(e);for(var n in r)this[n]=r[n]},p.prototype.parseBody=function(t){var e=f.parse[this.type];return e&&t&&(t.length||t instanceof Object)?e(t):null},p.prototype.setStatusProperties=function(t){1223===t&&(t=204);var e=t/100|0;this.status=t,this.statusType=e,this.info=1==e,this.ok=2==e,this.clientError=4==e,this.serverError=5==e,this.error=4==e||5==e?this.toError():!1,this.accepted=202==t,this.noContent=204==t,this.badRequest=400==t,this.unauthorized=401==t,this.notAcceptable=406==t,this.notFound=404==t,this.forbidden=403==t},p.prototype.toError=function(){var t=this.req,e=t.method,r=t.url,n="cannot "+e+" "+r+" ("+this.status+")",o=new Error(n);return o.status=this.status,o.method=e,o.url=r,o},f.Response=p,d(l.prototype),l.prototype.use=function(t){return t(this),this},l.prototype.timeout=function(t){return this._timeout=t,this},l.prototype.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this},l.prototype.abort=function(){return this.aborted?void 0:(this.aborted=!0,this.xhr.abort(),this.clearTimeout(),this.emit("abort"),this)},l.prototype.set=function(t,e){if(i(t)){for(var r in t)this.set(r,t[r]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this},l.prototype.unset=function(t){return delete this._header[t.toLowerCase()],delete this.header[t],this},l.prototype.getHeader=function(t){return this._header[t.toLowerCase()]},l.prototype.type=function(t){return this.set("Content-Type",f.types[t]||t),this},l.prototype.accept=function(t){return this.set("Accept",f.types[t]||t),this},l.prototype.auth=function(t,e){var r=btoa(t+":"+e);return this.set("Authorization","Basic "+r),this},l.prototype.query=function(t){return"string"!=typeof t&&(t=s(t)),t&&this._query.push(t),this},l.prototype.field=function(t,e){return this._formData||(this._formData=new F.FormData),this._formData.append(t,e),this},l.prototype.attach=function(t,e,r){return this._formData||(this._formData=new F.FormData),this._formData.append(t,e,r),this},l.prototype.send=function(t){var e=i(t),r=this.getHeader("Content-Type");if(e&&i(this._data))for(var n in t)this._data[n]=t[n];else"string"==typeof t?(r||this.type("form"),r=this.getHeader("Content-Type"),"application/x-www-form-urlencoded"==r?this._data=this._data?this._data+"&"+t:t:this._data=(this._data||"")+t):this._data=t;return!e||o(t)?this:(r||this.type("json"),this)},l.prototype.callback=function(t,e){var r=this._callback;this.clearTimeout(),r(t,e)},l.prototype.crossDomainError=function(){var t=new Error("Origin is not allowed by Access-Control-Allow-Origin");t.crossDomain=!0,this.callback(t)},l.prototype.timeoutError=function(){var t=this._timeout,e=new Error("timeout of "+t+"ms exceeded");e.timeout=t,this.callback(e)},l.prototype.withCredentials=function(){return this._withCredentials=!0,this},l.prototype.end=function(t){var e=this,r=this.xhr=f.getXHR(),i=this._query.join("&"),s=this._timeout,u=this._formData||this._data;this._callback=t||n,r.onreadystatechange=function(){if(4==r.readyState){var t;try{t=r.status}catch(n){t=0}if(0==t){if(e.timedout)return e.timeoutError();if(e.aborted)return;return e.crossDomainError()}e.emit("end")}};var a=function(t){t.total>0&&(t.percent=t.loaded/t.total*100),e.emit("progress",t)};this.hasListeners("progress")&&(r.onprogress=a);try{r.upload&&this.hasListeners("progress")&&(r.upload.onprogress=a)}catch(c){}if(s&&!this._timer&&(this._timer=setTimeout(function(){e.timedout=!0,e.abort()},s)),i&&(i=f.serializeObject(i),this.url+=~this.url.indexOf("?")?"&"+i:"?"+i),r.open(this.method,this.url,!0),this._withCredentials&&(r.withCredentials=!0),"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof u&&!o(u)){var h=f.serialize[this.getHeader("Content-Type")];h&&(u=h(u))}for(var p in this.header)null!=this.header[p]&&r.setRequestHeader(p,this.header[p]);return this.emit("request",this),r.send(u),this},f.Request=l,f.get=function(t,e,r){var n=f("GET",t);return"function"==typeof e&&(r=e,e=null),e&&n.query(e),r&&n.end(r),n},f.head=function(t,e,r){var n=f("HEAD",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n},f.del=function(t,e){var r=f("DELETE",t);return e&&r.end(e),r},f.patch=function(t,e,r){var n=f("PATCH",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n},f.post=function(t,e,r){var n=f("POST",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n},f.put=function(t,e,r){var n=f("PUT",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n},t.exports=f},function(t,e){function r(t){return t?n(t):void 0}function n(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}t.exports=r,r.prototype.on=r.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks[t]=this._callbacks[t]||[]).push(e),this},r.prototype.once=function(t,e){function r(){n.off(t,r),e.apply(this,arguments)}var n=this;return this._callbacks=this._callbacks||{},r.fn=e,this.on(t,r),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r=this._callbacks[t];if(!r)return this;if(1==arguments.length)return delete this._callbacks[t],this;for(var n,o=0;o<r.length;o++)if(n=r[o],n===e||n.fn===e){r.splice(o,1);break}return this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),r=this._callbacks[t];if(r){r=r.slice(0);for(var n=0,o=r.length;o>n;++n)r[n].apply(this,e)}return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks[t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e){t.exports=function(t,e,r){for(var n=0,o=t.length,i=3==arguments.length?r:t[n++];o>n;)i=e.call(null,i,t[n],++n,t);return i}},function(t,e,r){"use strict";function n(t){this.recapture=t,this.init()}var o=r(2),i=r(13);n.prototype.init=function(){this.timers=[],this.nodes=null,this.findNodes(),this.attachListeners()},n.prototype.findNodes=function(){this.nodes=document.getElementsByTagName("input")},n.prototype.attachListeners=function(){if(this.nodes&&this.nodes.length)for(var t=0,e=this.nodes.length;e>t;t++)this.nodes[t].value&&this.done.call(this,this.nodes[t].value),i.add(this.nodes[t],"keyup",this.waitForTyping.bind(this)),this.timers.push(0)},n.prototype.waitForTyping=function(t){for(var e=t.target.value,r=0,n=this.nodes.length;n>r;r++)this.nodes[r]===t.target&&(clearTimeout(this.timers[r]),this.timers[r]=setTimeout(this.done.bind(this,e),2e3))},n.prototype.done=function(t){var e=o(t);e&&this.recapture.email({email:t})},t.exports=function(t){return new n(t)}},function(t,e,r){var n,o;!function(i,s){n=s,o="function"==typeof n?n.call(e,r,e,t):n,!(void 0!==o&&(t.exports=o))}(this,function(){function t(t,e){return function(r,n,o,i){r[t]?r[t](n,o,i):r[e]&&r[e]("on"+n,o)}}return{add:t("addEventListener","attachEvent"),remove:t("removeEventListener","detachEvent")}})}])});